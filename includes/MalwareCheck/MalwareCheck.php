<?php

namespace NewfoldLabs\WP\Module\Hosting\MalwareCheck;

use NewfoldLabs\WP\Module\Installer\Services\PluginInstaller;
use NewfoldLabs\WP\Module\Hosting\Helpers\APIHelper;

/**
 * Handles malware check-related functionality.
 */
class MalwareCheck {

	/**
	 * Dependency container instance.
	 *
	 * @var mixed
	 */
	protected $container;

	/**
	 * MalwareCheck constructor.
	 *
	 * @param mixed $container The dependency container instance.
	 */
	public function __construct( $container ) {
		$this->container = $container;
	}

	/**
	 * Retrieves the Jetpack registration nonce, API paths, install token, and URLs.
	 *
	 * @return array Malware check data.
	 */
	public function get_data() {
		$plugin_basename = $this->container->plugin()->brand;

		return array(
			'registration_nonce' => wp_create_nonce( 'jetpack-registration-nonce' ),
			'install_token'      => PluginInstaller::rest_get_plugin_install_hash(),
			'plugin'             => 'jetpack-protect',
			'api'                => array(
				'jetpackRegister' => APIHelper::get_rest_api_url( '/jetpack/v4/connection/register' ),
				'scanStatus'      => APIHelper::get_rest_api_url(
					'/jetpack-protect/v1/status',
					array(
						'hard_refresh' => 'true',
						'_locale'      => 'user',
					)
				),
				'pluginInstall'   => APIHelper::get_rest_api_url( '/newfold-installer/v1/plugins/install' ),
			),
			'urls'               => array(
				'scanPage'    => admin_url( 'admin.php?page=jetpack-protect#/scan' ),
				'supportPage' => admin_url( "admin.php?page={$plugin_basename}#/help" ),
			),
		);
	}
}
